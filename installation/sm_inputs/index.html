
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the AWS Secure Environment Accelerator">
      
      
        <meta name="author" content="Amazon Web Services">
      
      
        <link rel="canonical" href="https://awssea.github.io/installation/sm_inputs/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.9">
    
    
      
        <title>1. **State Machine Behavior and Inputs** - AWS Secure Environment Accelerator</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2b4465f4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-state-machine-behavior-and-inputs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="AWS Secure Environment Accelerator" class="md-header__button md-logo" aria-label="AWS Secure Environment Accelerator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AWS Secure Environment Accelerator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              1. **State Machine Behavior and Inputs**
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../faq/" class="md-tabs__link">
      FAQ
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../about/" class="md-tabs__link">
      About
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../" class="md-tabs__link">
      Installation & Upgrades
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../operations/" class="md-tabs__link">
      Operations & Troubleshooting
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../developer/" class="md-tabs__link">
      Developer Guide
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="https://github.com/aws-samples/aws-secure-environment-accelerator/blob/main/CONTRIBUTING.md" class="md-tabs__link">
      Contributing & Governanace
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../architectures/pbmm/" class="md-tabs__link">
      Prescriptive PBMM Architecture
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../workshops/" class="md-tabs__link">
      Workshops
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="AWS Secure Environment Accelerator" class="md-nav__button md-logo" aria-label="AWS Secure Environment Accelerator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    AWS Secure Environment Accelerator
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Installation & Upgrades
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../operations/" class="md-nav__link">
        Operations & Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../developer/" class="md-nav__link">
        Developer Guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/aws-samples/aws-secure-environment-accelerator/blob/main/CONTRIBUTING.md" class="md-nav__link">
        Contributing & Governanace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../architectures/pbmm/" class="md-nav__link">
        Prescriptive PBMM Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../workshops/" class="md-nav__link">
        Workshops
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#11-state-machine-behavior" class="md-nav__link">
    1.1. State Machine Behavior
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="1-state-machine-behavior-and-inputs">1. <strong>State Machine Behavior and Inputs</strong></h1>
<ul>
<li><a href="#1-state-machine-behavior-and-inputs">1. <strong>State Machine Behavior and Inputs</strong></a></li>
<li><a href="#11-state-machine-behavior">1.1. State Machine Behavior</a></li>
<li><a href="#2-accelerator-state-machine-inputs">2. <strong>Accelerator State Machine Inputs</strong></a></li>
<li><a href="#21-rebuild-dynamodb-table-contents">2.1. Rebuild DynamoDB table contents</a></li>
<li><a href="#22-bypass-all-config-file-validation-checks">2.2. Bypass <strong>ALL</strong> config file validation checks</a></li>
<li><a href="#23-bypassing-specific-config-file-validation-checks">2.3. Bypassing SPECIFIC config file validation checks</a></li>
<li><a href="#24-generate-verbose-logging-within-state-machine">2.4. Generate verbose logging within state machine</a></li>
<li><a href="#25-state-machine-scoping-inputs">2.5. State Machine scoping inputs</a></li>
<li><a href="#26-example-of-combined-inputs">2.6. Example of combined inputs</a></li>
</ul>
<h2 id="11-state-machine-behavior">1.1. State Machine Behavior</h2>
<p>Accelerator v1.3.0 makes a significant change to the manner in which the state machine operates. These changes include:</p>
<ol>
<li>Reducing the <code>default scope</code> of execution of the state machine to only target newly created AWS accounts and AWS accounts listed in the mandatory accounts section of the config file.</li>
<li><code>default scope</code> refers to running the state machine without any input parameters;</li>
<li>This new default scope disallows any changes to the config file outside new accounts;</li>
<li>NOTE: it is critical that accounts for which others are dependant upon, MUST be located within the <code>mandatory-account-configs</code> section of the config file (i.e. management, log-archive, security, operations, shared-network, perimeter, etc.).</li>
<li>The state machine now accepts a new input parameter, <code>scope</code>, which accepts the following values: <code>FULL</code> | <code>NEW-ACCOUNTS</code> | <code>GLOBAL-OPTIONS</code> | <code>ACCOUNT</code> | <code>OU</code>.</li>
<li>when the <code>scope</code> parameter is supplied, you must also supply the <code>mode</code> parameter. At this time <code>mode</code> only accepts the value <code>APPLY</code>. To be specific <code>"mode":"APPLY"</code> is mandatory when running the state machine with the <code>"scope":</code> parameter.</li>
<li>Starting the state machine with <code>{"scope":"FULL","mode":"APPLY"}</code> makes the state machine execute as it did in v1.2.6 and below.</li>
<li>The state machine targets all AWS accounts and allows changes across any section of the config file;</li>
<li>The blocks and overrides described in section 1.4 above remain valid;</li>
<li><code>FULL</code> mode must be run at least once immediately after any Accelerator version upgrade. Code Pipeline automatically starts the state machine with <code>{"scope":"FULL","mode":"APPLY"}</code>. If the state machine fails for any reason after upgrade, the state machine must be restarted with these parameters until a successful execution of the state machine has completed.</li>
<li>Starting the state machine with <code>{"scope":"NEW-ACCOUNTS","mode":"APPLY"}</code> is the same as operating the state machine with the <code>default scope</code> as described in the first bullet</li>
<li>Starting the state machine with <code>{"scope":"GLOBAL-OPTIONS","mode":"APPLY"}</code> restricts changes to the config file to the <code>global-options</code> section.</li>
<li>If any other portion of the config file was updated or changed, the state machine will fail;</li>
<li>The global options scope executes the state machine on the entire managed account footprint.</li>
<li>Starting the state machine with <code>{"scope":"OU","targetOus":[X],"mode":"APPLY"}</code> restricts changes to the config file to the specified <code>organizational-units</code> section(s) defined by <code>targetOus</code>.</li>
<li>When <code>scope=OU</code>, <code>targetOus</code> becomes a mandatory parameter;</li>
<li><code>X</code> can be any one or more valid OU names, or the value <code>"ALL"</code>;</li>
<li>When <code>["ALL"]</code> is specified, the state machine targets all AWS accounts, but only allows changes to the <code>organizational-units</code> section of the config file;</li>
<li>When OUs are specified (i.e. <code>["Dev","Test"]</code>), the state machine only targets mandatory accounts plus accounts in the specified OUs (Dev, Test), and only allows changes to the specified OUs sections (Dev, Test) of the config file;</li>
<li>If any other portion of the config file was updated or changed, the state machine will fail.</li>
<li>Starting the state machine with <code>{"scope":"ACCOUNT","targetAccounts":[X],"mode":"APPLY"}</code> restricts changes to the config file to the specified <code>xxx-account-configs</code> section(s) defined by <code>targetAccounts</code>.</li>
<li>When <code>scope=ACCOUNT</code>, <code>targetAccounts</code> becomes a mandatory parameter;</li>
<li><code>X</code> can be any one or more valid account numbers, the value <code>"NEW"</code>, or the value <code>"ALL"</code>;</li>
<li>When <code>["ALL"]</code> is specified, the state machine targets all AWS accounts, but only allows changes to the <code>xxx-account-configs</code> sections of the config file;</li>
<li>When specific accounts and/or <code>NEW</code> is specified (i.e. <code>["NEW", "123456789012", "234567890123"]</code>), the state machine only targets mandatory accounts plus the listed accounts and any newly created accounts. It also only allows changes to the specified accounts sections (New, 123456789012, 234567890123) of the config file;</li>
<li>If any other portion of the config file was updated or changed, the state machine will fail.</li>
</ol>
<p>Starting in v1.3.0, we recommend running the state machine with the parameters that most tightly scope the state machines execution to your planned changes and minimizing the use of <code>FULL</code> scope execution.</p>
<ul>
<li>should you accidentally change the wrong section of the config file, you will be protected;</li>
<li>as you grow and scale to hundreds or thousands of accounts, your state machine execution time will remain fast.</li>
</ul>
<p><strong>NOTE 1:</strong> The <code>scope</code> setting has no impact on SCP application, limit requests, custom tagging, or directory sharing.</p>
<p><strong>NOTE 2:</strong> All comparisons for config file changes are assessed AFTER all replacements have been made. Changing variable names which result in the same end outcome do NOT appear as a change to the config file.</p>
<h1 id="2-accelerator-state-machine-inputs">2. <strong>Accelerator State Machine Inputs</strong></h1>
<h2 id="21-rebuild-dynamodb-table-contents">2.1. Rebuild DynamoDB table contents</h2>
<p>With the exception of the Outputs table, the contents of the Accelerator DynamoDB tables are rebuilt on every state machine execution. We recently started depending on the Outputs DynamoDB tables to ensure the parameters in parameter store are consistently maintained in the same order as objects are created and deleted. Should the CONTENTS of the tables be destroyed or corrupted, customers can force a rebuild of the CloudFormation Outputs in DynamoDB by starting the state machine with the parameter:</p>
<pre><code>{ &quot;storeAllOutputs&quot;: true }
</code></pre>
<p>This should be completed BEFORE running the state machine with a corrupt or empty DynamoDB table or the Accelerator is likely to reorder a customers parameters. If the DynamoDB tables were completely destroyed, they must be recreated before running the state machine with this parameter.</p>
<h2 id="22-bypass-all-config-file-validation-checks">2.2. Bypass <strong>ALL</strong> config file validation checks</h2>
<p>This parameter should be specified with extreme caution, as it bypasses all config file validation. The state machine typically has protections enabled preventing customers from making breaking changes to the config file. Under certain conditions with the support of a trained expert, bypassing these checks is required. Start the state machine with the parameter:</p>
<pre><code>{ &quot;overrideComparison&quot;: true }
</code></pre>
<p><strong><em>Customers are encouraged to use the specific override variables below, rather than the all-inclusive override, to ensure they only bypasses intended config changes.</em></strong></p>
<h2 id="23-bypassing-specific-config-file-validation-checks">2.3. Bypassing SPECIFIC config file validation checks</h2>
<p>Providing any one or more of the following flags will only override the specified check(s):</p>
<pre><code> {
   &quot;configOverrides&quot;: {
     'ov-global-options': true,
     'ov-del-accts': true,
     'ov-ren-accts': true,
     'ov-acct-email': true,
     'ov-acct-ou': true,
     'ov-acct-vpc': true,
     'ov-acct-subnet': true,
     'ov-acct-vpc-optin': true,
     'ov-tgw': true,
     'ov-mad': true,
     'ov-ou-vpc': true,
     'ov-ou-subnet': true,
     'ov-share-to-ou': true,
     'ov-share-to-accounts': true,
     'ov-nacl': true,
     'ov-nfw': true
    }
 }
</code></pre>
<h2 id="24-generate-verbose-logging-within-state-machine">2.4. Generate verbose logging within state machine</h2>
<ul>
<li>Added "verbose": "1" state machine input options</li>
<li>parameter is optional</li>
<li>parameter defaults to 0</li>
</ul>
<pre><code>{&quot;scope&quot;:&quot;FULL&quot;, &quot;mode&quot;:&quot;APPLY&quot;, &quot;verbose&quot;:&quot;1&quot;}
</code></pre>
<h2 id="25-state-machine-scoping-inputs">2.5. State Machine scoping inputs</h2>
<p>Summary of inputs, per section 1.1 above:</p>
<pre><code>{&quot;scope&quot;:&quot;FULL&quot;, &quot;mode&quot;:&quot;APPLY&quot;}
</code></pre>
<pre><code>{&quot;scope&quot;:&quot;NEW-ACCOUNTS&quot;, &quot;mode&quot;:&quot;APPLY&quot;}
</code></pre>
<pre><code>{&quot;scope&quot;:&quot;GLOBAL-OPTIONS&quot;, &quot;mode&quot;:&quot;APPLY&quot;}
</code></pre>
<pre><code>{&quot;scope&quot;:&quot;OU&quot;, &quot;targetOus&quot;:[&quot;ou-name&quot;, &quot;ou-name&quot;], &quot;mode&quot;:&quot;APPLY&quot;}
</code></pre>
<pre><code>{&quot;scope&quot;:&quot;ACCOUNT&quot;, &quot;targetAccounts&quot;:[&quot;123456789012&quot;,&quot;234567890123&quot;], &quot;mode&quot;:&quot;APPLY&quot;}
</code></pre>
<h2 id="26-example-of-combined-inputs">2.6. Example of combined inputs</h2>
<pre><code>{&quot;scope&quot;: &quot;FULL&quot;, &quot;mode&quot;: &quot;APPLY&quot;, &quot;configOverrides&quot;: {&quot;ov-ou-vpc&quot;: true, &quot;ov-ou-subnet&quot;: true, &quot;ov-acct-vpc&quot;: true }}
</code></pre>
<hr />
<p><a href="../..">...Return to Accelerator Table of Contents</a></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.960e086b.min.js"></script>
      
    
  </body>
</html>